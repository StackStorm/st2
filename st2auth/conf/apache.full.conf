<VirtualHost *:443>

    ServerName 172.168.50.50:443

    DocumentRoot /opt/stackstorm/static/webui

    ProxyPass /api http://localhost:9101

    WSGIScriptAlias /auth /usr/lib/python2.7/dist-packages/st2auth/wsgi.py
    WSGIDaemonProcess st2auth user=stanley group=stanley processes=2 threads=25
    WSGIProcessGroup st2auth

    SSLEngine on
    SSLCertificateFile /etc/apache2/ssl/mycert.crt
    SSLCertificateKeyFile /etc/apache2/ssl/mycert.key

    AddExternalAuth pwauth /usr/sbin/pwauth
    SetExternalAuthMethod pwauth pipe

    LogLevel warn
    ErrorLog /tmp/st2auth.error.log
    CustomLog /tmp/st2auth.access.log combined

    <Directory /opt/stackstorm/static/webui>
        Order allow,deny
        Allow from all
        Require all granted
    </Directory>

    <Proxy *>
        Order allow,deny
        Allow from all
    </Proxy>

    <Directory /usr/lib/python2.7/dist-packages/st2auth>
        <Files wsgi.py>
            Order deny,allow
            Allow from all
        </Files>
        AuthType Basic
        AuthName "Restricted"
        AuthBasicProvider external
        AuthExternal pwauth
        <LimitExcept OPTIONS>
                Require unix-group st2ops
        </LimitExcept>
    </Directory>

</VirtualHost>
